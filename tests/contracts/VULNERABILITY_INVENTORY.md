# Test Contracts Vulnerability Inventory

**Last Updated**: October 13, 2025
**SolidityDefend Version**: v1.0.0
**Total Test Contracts**: 32

---

## Purpose

This document provides a comprehensive inventory of all test contracts in the SolidityDefend test suite, documenting the specific vulnerabilities intentionally embedded in each contract. Use this inventory to:

1. **Verify Detection**: Compare SolidityDefend analysis results with known vulnerabilities
2. **False Positive Analysis**: Identify when detectors flag issues that don't exist
3. **False Negative Analysis**: Identify vulnerabilities that detectors miss
4. **Test Coverage**: Ensure all detector types have appropriate test cases
5. **Benchmarking**: Measure detection accuracy and performance

---

## Directory Structure

```
tests/contracts/
├── basic_vulnerabilities/       # Simple, focused vulnerability examples
├── clean_examples/              # Secure contracts with no vulnerabilities
├── complex_scenarios/           # Multi-vulnerability real-world scenarios
├── cross_chain/                 # Cross-chain and bridge vulnerabilities
├── erc4626_vaults/             # ERC-4626 vault-specific vulnerabilities
└── VULNERABILITY_INVENTORY.md   # This file
```

---

## 1. Basic Vulnerabilities

### 1.1 access_control_issues.sol

**Location**: `basic_vulnerabilities/access_control_issues.sol`
**Contract**: `AccessControlIssues`
**Complexity**: Simple
**Purpose**: Test access control and authorization detectors

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 11-15 | Unprotected Initializer | High | `access-control` | `initialize()` function can be called by anyone, allowing attacker to take ownership |
| 18-20 | Missing Access Control | Critical | `access-control` | `setOwner()` has no access control, anyone can change owner |
| 23-27 | Unauthorized Withdrawal | Critical | `access-control` | `withdraw()` allows anyone to withdraw funds |
| 30-32 | Default Visibility | Medium | `validation` | `updateBalance()` missing explicit visibility modifier |

**Expected Detections**: 4 issues
**Clean Functions**: `emergencyStop()` (lines 40-42) - properly protected with `onlyOwner` modifier

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/access_control_issues.sol
```

---

### 1.2 reentrancy_issues.sol

**Location**: `basic_vulnerabilities/reentrancy_issues.sol`
**Contract**: `ReentrancyIssues`
**Complexity**: Simple
**Purpose**: Test reentrancy detection

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 13-21 | Classic Reentrancy | Critical | `reentrancy` | External call before state update in `withdraw()` |
| 28-34 | Read-Only Reentrancy | Medium | `reentrancy` | External view call used before state update in `withdrawBasedOnBalance()` |

**Expected Detections**: 2 issues
**Attack Vectors**:
- Classic reentrancy: Attacker can re-enter `withdraw()` before balance update
- Read-only reentrancy: Balance read can be exploited if attacker re-enters

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/reentrancy_issues.sol
```

---

### 1.3 validation_issues.sol

**Location**: `basic_vulnerabilities/validation_issues.sol`
**Contract**: `ValidationIssues`
**Complexity**: Simple
**Purpose**: Test input validation and logic error detectors

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 10-12 | Missing Zero Address Check | Medium | `validation`, `zero-address` | `setToken()` doesn't validate address is not zero |
| 15-17 | Array Bounds Issue | High | `validation`, `array-bounds` | `updateValue()` doesn't check array bounds |
| 20-22 | Division Before Multiplication | Medium | `division-order` | Precision loss due to division before multiplication |
| 25-29 | Missing Parameter Validation | Medium | `missing-input-validation` | `transfer()` doesn't validate amount > 0 or data length |
| 32-35 | Unchecked External Call | High | `external` | `callExternalContract()` doesn't check call success |

**Expected Detections**: 5 issues

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/validation_issues.sol
```

---

## 2. Clean Examples

### 2.1 clean_contract.sol

**Location**: `clean_examples/clean_contract.sol`
**Contract**: `CleanContract`
**Complexity**: Simple
**Purpose**: Baseline for false positive testing

**Vulnerabilities**: **NONE** (This is a secure contract)

**Security Features**:
- ✅ OpenZeppelin Ownable for access control
- ✅ ReentrancyGuard on withdrawal
- ✅ State updated before external calls
- ✅ Zero address validation
- ✅ Amount validation (> 0 checks)
- ✅ Proper event emissions
- ✅ Emergency withdrawal with owner-only access

**Expected Detections**: 0 issues (any detection is a false positive)

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/clean_examples/clean_contract.sol
```

---

## 3. Complex Scenarios (2025 Vulnerabilities)

### 3.1 FlashLoanArbitrage.sol

**Location**: `complex_scenarios/2025_vulnerabilities/defi/FlashLoanArbitrage.sol`
**Contract**: `FlashLoanArbitrage`
**Complexity**: High
**Purpose**: Modern DeFi arbitrage vulnerabilities

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 86-99 | No MEV Protection | High | `mev-extractable-value` | `executeArbitrage()` susceptible to frontrunning |
| 91-92 | Price Manipulation | Critical | `oracle-manipulation`, `price-manipulation` | Price calculated before flash loan, can be manipulated |
| 94-95 | State Modification Before External Call | Medium | `reentrancy` | `currentArbitrageAmount` set before external flash loan call |
| 104-140 | Flash Loan Callback Reentrancy | High | `reentrancy`, `flashloan` | Complex reentrancy in `onFlashLoan()` despite ReentrancyGuard |
| 110-111 | Missing Flash Loan Provider Validation | Critical | `external` | No validation that caller is legitimate flash loan provider |
| 116-117 | Real-Time Price Fetching | Critical | `oracle-manipulation` | Prices fetched during execution, vulnerable to MEV |
| 145-155 | Spot Price Usage | Critical | `oracle-manipulation` | Using spot prices without TWAP in `calculatePotentialProfit()` |
| 150-154 | No Slippage Calculation | High | `slippage-protection` | Large trades executed without slippage protection |
| 171-177 | Zero Slippage Protection | Critical | `slippage-protection` | `swapExactTokensForTokens()` with `amountOutMin = 0` |
| 213-220 | Profit Withdrawal Access Control | High | `access-control` | Anyone can withdraw profits (though limited to own balance) |
| 225-228 | Emergency Withdrawal During Flash Loan | Critical | `flashloan` | `emergencyWithdraw()` can steal flash loan funds |
| 252-254 | Unprotected Fallback | Medium | `external` | `receive()` accepts ETH without validation |

**Expected Detections**: 12+ issues
**Attack Scenarios**:
- MEV bot frontruns arbitrage transaction
- Attacker manipulates DEX prices before execution
- Flash loan provider impersonation
- Emergency withdrawal during active flash loan

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/complex_scenarios/2025_vulnerabilities/defi/FlashLoanArbitrage.sol
```

---

### 3.2 DAOGovernance.sol

**Location**: `complex_scenarios/2025_vulnerabilities/governance/DAOGovernance.sol`
**Contract**: `DAOGovernance`
**Complexity**: Very High
**Purpose**: Modern governance attack vectors

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 160 | Flash Loan Governance Attack | Critical | `flashloan`, `governance` | Proposal threshold check bypassable with flash loan |
| 162-163 | No Proposal Cooldown | Medium | `governance` | Same address can create unlimited proposals |
| 196-222 | Signature Replay Attack | Critical | `signature-replay`, `weak-signature-validation` | `castVoteBySig()` has no nonce for replay protection |
| 242 | Current Block Voting Power | Critical | `governance`, `flashloan` | Voting power calculated at current block, not snapshot |
| 246-249 | Vote Delegation Manipulation | High | `delegation-loop`, `governance` | Delegation can be manipulated during active voting |
| 277-278 | ETA Manipulation | Medium | `timestamp-manipulation` | Execution time can be manipulated by admin |
| 294-310 | External Calls in Loop | High | `dos-unbounded-operation` | Multiple external calls without proper error handling |
| 300-308 | Continues on Failure | Medium | `external` | Execution continues even if some calls fail |
| 318-333 | Guardian Cancel Authority | High | `centralization-risk` | Guardian can cancel any proposal |
| 338-359 | Delegation Loop Vulnerability | Critical | `delegation-loop` | No protection against circular delegation |
| 342-343 | No Delegation Timelock | Medium | `governance` | Delegation changes immediate, no cooldown |
| 364-371 | Flash Loan Voting | Critical | `flashloan`, `governance` | Current balance used, no snapshot protection |
| 404-405 | Quorum Manipulation | High | `governance` | Quorum based on current supply, can be manipulated |
| 411-414 | Emergency Pause Abuse | High | `centralization-risk`, `emergency-function-abuse` | No timelock or multi-sig for emergency pause |
| 426-437 | Immediate Parameter Changes | Medium | `governance` | Governance parameters changeable without proposal |
| 442-457 | Cross-Chain State Inconsistency | High | `cross-chain-replay` | No validation of cross-chain state |
| 452-454 | Cross-Chain Message Validation | Critical | `bridge-message-verification` | No verification of cross-chain message authenticity |
| 467 | Unvalidated Fallback | Medium | `external` | `receive()` accepts ETH without validation |

**Expected Detections**: 18+ issues
**Attack Scenarios**:
- Flash loan attack to pass proposal threshold
- Vote with borrowed tokens
- Delegation loop to amplify voting power
- Signature replay across proposals
- Guardian centralization abuse
- Cross-chain governance manipulation

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/complex_scenarios/2025_vulnerabilities/governance/DAOGovernance.sol
```

---

### 3.3 BridgeVault.sol

**Location**: `complex_scenarios/2025_vulnerabilities/cross_chain/BridgeVault.sol`
**Expected Vulnerabilities**: Bridge-specific vulnerabilities (chain ID, message verification, replay attacks)

---

### 3.4 MEVProtectedDEX.sol

**Location**: `complex_scenarios/2025_vulnerabilities/mev/MEVProtectedDEX.sol`
**Expected Vulnerabilities**: MEV protection bypass, sandwich attack vectors, deadline manipulation

---

### 3.5 LiquidityMining.sol

**Location**: `complex_scenarios/2025_vulnerabilities/yield_farming/LiquidityMining.sol`
**Expected Vulnerabilities**: Reward calculation errors, staking manipulation, JIT attacks

---

## 4. Cross-Chain Vulnerabilities

### 4.1 Bridge Chain ID Validation

**Location**: `cross_chain/phase13_legacy/bridge_chain_id/`

#### vulnerable_simple.sol

**Contract**: `VulnerableBridge`
**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 13-22 | Missing Chain-ID Validation | Critical | `bridge-chain-id-validation` | `processMessage()` doesn't validate destination chain |
| 26-37 | No Chain Check | Critical | `bridge-chain-id-validation` | `receiveMessage()` executes without chain validation |

**Expected Detections**: 2 issues
**Attack**: Message intended for chain A replayed on chain B

#### vulnerable_complex.sol

**Expected**: Multiple chain-ID validation issues with complex bridge logic

#### clean.sol

**Expected**: 0 issues (proper chain-ID validation implemented)

**Test Commands**:
```bash
./target/release/soliditydefend tests/contracts/cross_chain/phase13_legacy/bridge_chain_id/vulnerable_simple.sol
./target/release/soliditydefend tests/contracts/cross_chain/phase13_legacy/bridge_chain_id/vulnerable_complex.sol
./target/release/soliditydefend tests/contracts/cross_chain/phase13_legacy/bridge_chain_id/clean.sol
```

---

### 4.2 Bridge Message Verification

**Location**: `cross_chain/phase13_legacy/bridge_message_verification/`

**Contracts**:
- `vulnerable_simple.sol` - Missing signature/proof verification
- `vulnerable_complex.sol` - Complex verification bypass scenarios
- `test_merkle.sol` - Merkle proof validation issues
- `clean.sol` - Proper message verification

**Expected Vulnerabilities**: Message forgery, missing signature validation, weak proof verification

---

### 4.3 Bridge Token Minting

**Location**: `cross_chain/phase13_legacy/bridge_token_minting/`

**Contracts**:
- `vulnerable_simple.sol` - Unrestricted minting
- `vulnerable_complex.sol` - Complex minting vulnerabilities
- `test_modifier.sol` - Modifier bypass scenarios
- `clean.sol` - Proper minting access control

**Expected Vulnerabilities**: Unauthorized minting, missing access control, bridge role abuse

---

## 5. ERC-4626 Vault Vulnerabilities

### 5.1 Vulnerable Vaults

#### VulnerableVault_Inflation.sol

**Location**: `erc4626_vaults/VulnerableVault_Inflation.sol`
**Contract**: `VulnerableVault_Inflation`
**Complexity**: Medium
**Purpose**: Share inflation attack pattern

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 51-72 | Share Inflation Attack | Critical | `vault-share-inflation` | First depositor can manipulate share price |
| 54-60 | No Minimum Deposit | Critical | `vault-share-inflation` | Allows 1 wei deposit for manipulation |
| 59 | Direct Transfer Manipulation | Critical | `vault-donation-attack` | Uses `balanceOf()` instead of internal accounting |
| 64 | No Share Validation | High | `vault-share-inflation` | Allows zero shares to be minted (rounds down) |
| 94-98 | Total Assets Calculation | Critical | `vault-donation-attack` | `totalAssets()` uses manipulable `balanceOf()` |

**Expected Detections**: 5 issues
**Attack Scenario**:
1. Attacker deposits 1 wei → receives 1 share
2. Attacker directly transfers 10,000 tokens → inflates share price
3. Victim deposits 20,000 tokens → receives ~1 share (rounds down)
4. Attacker redeems 1 share → gets half of total assets
5. Victim loses ~10,000 tokens to rounding

**Reference**: Cetus DEX exploit (May 2025, $223M)

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/erc4626_vaults/VulnerableVault_Inflation.sol
```

---

#### VulnerableVault_Donation.sol

**Expected Vulnerabilities**: Donation attack, direct transfer manipulation, share price inflation

---

#### VulnerableVault_FeeManipulation.sol

**Expected Vulnerabilities**: Fee calculation errors, fee bypass, excessive fee extraction

---

#### VulnerableVault_HookReentrancy.sol

**Expected Vulnerabilities**: Hook callback reentrancy, ERC-777/ERC-1155 receiver exploits

---

#### VulnerableVault_WithdrawalDOS.sol

**Expected Vulnerabilities**: Withdrawal denial of service, griefing attacks, queue manipulation

---

### 5.2 Secure Vaults (Mitigation Examples)

#### SecureVault_VirtualShares.sol

**Mitigation**: Uses virtual shares offset to prevent inflation
**Expected Detections**: 0 issues

---

#### SecureVault_DeadShares.sol

**Mitigation**: Mints dead shares at deployment
**Expected Detections**: 0 issues

---

#### SecureVault_MinimumDeposit.sol

**Mitigation**: Enforces minimum deposit amount
**Expected Detections**: 0 issues

---

#### SecureVault_InternalAccounting.sol

**Mitigation**: Uses internal balance tracking instead of `balanceOf()`
**Expected Detections**: 0 issues

---

## Summary Statistics

### By Category

| Category | Total Contracts | Vulnerable | Clean | Complex |
|----------|----------------|-----------|-------|---------|
| Basic Vulnerabilities | 3 | 3 | 0 | 0 |
| Clean Examples | 1 | 0 | 1 | 0 |
| Complex Scenarios | 5 | 5 | 0 | 5 |
| Cross-Chain | 14 | 9 | 5 | 4 |
| ERC-4626 Vaults | 9 | 5 | 4 | 2 |
| **TOTAL** | **32** | **22** | **10** | **11** |

### By Severity

| Severity | Count | Percentage |
|----------|-------|-----------|
| Critical | 35+ | 45% |
| High | 25+ | 32% |
| Medium | 15+ | 19% |
| Low | 3+ | 4% |
| **TOTAL** | **78+** | **100%** |

### By Detector Category

| Category | Vulnerabilities | Key Detectors |
|----------|----------------|---------------|
| Access Control | 8+ | `access-control`, `auth` |
| Reentrancy | 6+ | `reentrancy`, `erc721-callback-reentrancy` |
| DeFi/Oracle | 15+ | `oracle-manipulation`, `price-manipulation`, `flashloan` |
| Governance | 12+ | `governance`, `flashloan`, `delegation-loop` |
| Cross-Chain | 10+ | `bridge-chain-id-validation`, `bridge-message-verification`, `cross-chain-replay` |
| ERC-4626 Vaults | 8+ | `vault-share-inflation`, `vault-donation-attack`, `vault-hook-reentrancy` |
| MEV | 6+ | `mev-extractable-value`, `slippage-protection`, `front-running-mitigation` |
| Validation | 8+ | `missing-input-validation`, `zero-address`, `array-bounds` |
| External Calls | 5+ | `external`, `dangerous-delegatecall` |

---

## Testing Methodology

### Full Suite Test

Run all test contracts:
```bash
find tests/contracts -name "*.sol" -type f | while read contract; do
    echo "Testing: $contract"
    ./target/release/soliditydefend "$contract" --format json > "results/$(basename $contract .sol).json"
done
```

### Category Tests

```bash
# Basic vulnerabilities
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/*.sol

# Clean examples (should have 0 detections)
./target/release/soliditydefend tests/contracts/clean_examples/*.sol

# Complex scenarios
./target/release/soliditydefend tests/contracts/complex_scenarios/2025_vulnerabilities/*/*.sol

# ERC-4626 vaults
./target/release/soliditydefend tests/contracts/erc4626_vaults/*.sol
```

### Comparison Analysis

1. **Run SolidityDefend**:
   ```bash
   ./target/release/soliditydefend <contract.sol> --format json > actual.json
   ```

2. **Compare with this inventory**:
   - Check if all documented vulnerabilities are detected
   - Check for false positives (detections not in inventory)
   - Check for false negatives (inventory items not detected)

3. **Calculate metrics**:
   - True Positives (TP): Correctly detected vulnerabilities
   - False Positives (FP): Incorrect detections
   - False Negatives (FN): Missed vulnerabilities
   - Precision: TP / (TP + FP)
   - Recall: TP / (TP + FN)
   - F1 Score: 2 * (Precision * Recall) / (Precision + Recall)

---

## Updating This Inventory

When adding new test contracts:

1. Create the contract in appropriate subdirectory
2. Add entry to this inventory with:
   - File location and contract name
   - Complexity level
   - Purpose/focus
   - Detailed vulnerability table
   - Expected detection count
   - Test command
   - Attack scenarios (if applicable)
3. Update summary statistics
4. Run validation to ensure documented vulnerabilities match code

---

## Notes

- **Line numbers** may shift if contracts are modified. Always verify against current code.
- **Detector IDs** are from SolidityDefend v1.0.0. Check `--list-detectors` for current IDs.
- **Severity levels** are estimates. Actual severity depends on context.
- **Expected detections** are minimum counts. Detectors may find additional related issues.
- Some contracts have **intentional vulnerabilities** for testing. DO NOT use in production.

---

**Maintained by**: SolidityDefend Development Team
**Version**: 1.0
**Last Verified**: v1.0.0 release (October 13, 2025)
