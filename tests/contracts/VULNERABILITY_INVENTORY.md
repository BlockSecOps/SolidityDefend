# Test Contracts Vulnerability Inventory

**Last Updated**: October 27, 2025
**SolidityDefend Version**: v0.11.1
**Total Test Contracts**: 41

---

## Purpose

This document provides a comprehensive inventory of all test contracts in the SolidityDefend test suite, documenting the specific vulnerabilities intentionally embedded in each contract. Use this inventory to:

1. **Verify Detection**: Compare SolidityDefend analysis results with known vulnerabilities
2. **False Positive Analysis**: Identify when detectors flag issues that don't exist
3. **False Negative Analysis**: Identify vulnerabilities that detectors miss
4. **Test Coverage**: Ensure all detector types have appropriate test cases
5. **Benchmarking**: Measure detection accuracy and performance

---

## Directory Structure

```
tests/contracts/
├── account_abstraction/         # ERC-4337 Account Abstraction vulnerabilities
│   ├── vulnerable/              # Vulnerable AA implementations
│   └── secure/                  # Secure AA implementations
├── basic_vulnerabilities/       # Simple, focused vulnerability examples
├── clean_examples/              # Secure contracts with no vulnerabilities
├── complex_scenarios/           # Multi-vulnerability real-world scenarios
├── cross_chain/                 # Cross-chain and bridge vulnerabilities
├── erc4626_vaults/             # ERC-4626 vault-specific vulnerabilities
├── flash_loans/                 # Flash loan attack vectors
│   ├── vulnerable/              # Vulnerable flash loan implementations
│   └── secure/                  # Secure flash loan implementations
└── VULNERABILITY_INVENTORY.md   # This file
```

---

## 1. Basic Vulnerabilities

### 1.1 access_control_issues.sol

**Location**: `basic_vulnerabilities/access_control_issues.sol`
**Contract**: `AccessControlIssues`
**Complexity**: Simple
**Purpose**: Test access control and authorization detectors

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 11-15 | Unprotected Initializer | High | `access-control` | `initialize()` function can be called by anyone, allowing attacker to take ownership |
| 18-20 | Missing Access Control | Critical | `access-control` | `setOwner()` has no access control, anyone can change owner |
| 23-27 | Unauthorized Withdrawal | Critical | `access-control` | `withdraw()` allows anyone to withdraw funds |
| 30-32 | Default Visibility | Medium | `validation` | `updateBalance()` missing explicit visibility modifier |

**Expected Detections**: 4 issues
**Findings Summary**: 2 critical, 1 high, 1 medium, 0 low
**Clean Functions**: `emergencyStop()` (lines 40-42) - properly protected with `onlyOwner` modifier

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/access_control_issues.sol
```

---

### 1.2 reentrancy_issues.sol

**Location**: `basic_vulnerabilities/reentrancy_issues.sol`
**Contract**: `ReentrancyIssues`
**Complexity**: Simple
**Purpose**: Test reentrancy detection

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 13-21 | Classic Reentrancy | Critical | `reentrancy` | External call before state update in `withdraw()` |
| 28-34 | Read-Only Reentrancy | Medium | `reentrancy` | External view call used before state update in `withdrawBasedOnBalance()` |

**Expected Detections**: 2 issues
**Findings Summary**: 1 critical, 0 high, 1 medium, 0 low
**Attack Vectors**:
- Classic reentrancy: Attacker can re-enter `withdraw()` before balance update
- Read-only reentrancy: Balance read can be exploited if attacker re-enters

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/reentrancy_issues.sol
```

---

### 1.3 validation_issues.sol

**Location**: `basic_vulnerabilities/validation_issues.sol`
**Contract**: `ValidationIssues`
**Complexity**: Simple
**Purpose**: Test input validation and logic error detectors

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 10-12 | Missing Zero Address Check | Medium | `validation`, `zero-address` | `setToken()` doesn't validate address is not zero |
| 15-17 | Array Bounds Issue | High | `validation`, `array-bounds` | `updateValue()` doesn't check array bounds |
| 20-22 | Division Before Multiplication | Medium | `division-order` | Precision loss due to division before multiplication |
| 25-29 | Missing Parameter Validation | Medium | `missing-input-validation` | `transfer()` doesn't validate amount > 0 or data length |
| 32-35 | Unchecked External Call | High | `external` | `callExternalContract()` doesn't check call success |

**Expected Detections**: 5 issues
**Findings Summary**: 0 critical, 2 high, 3 medium, 0 low

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/validation_issues.sol
```

---

## 2. Clean Examples

### 2.1 clean_contract.sol

**Location**: `clean_examples/clean_contract.sol`
**Contract**: `CleanContract`
**Complexity**: Simple
**Purpose**: Baseline for false positive testing

**Vulnerabilities**: **NONE** (This is a secure contract)

**Security Features**:
- ✅ OpenZeppelin Ownable for access control
- ✅ ReentrancyGuard on withdrawal
- ✅ State updated before external calls
- ✅ Zero address validation
- ✅ Amount validation (> 0 checks)
- ✅ Proper event emissions
- ✅ Emergency withdrawal with owner-only access

**Expected Detections**: 0 issues (any detection is a false positive)
**Findings Summary**: 0 critical, 0 high, 0 medium, 0 low

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/clean_examples/clean_contract.sol
```

---

## 3. Account Abstraction (ERC-4337) Vulnerabilities

### 3.1 VulnerablePaymaster.sol

**Location**: `account_abstraction/vulnerable/VulnerablePaymaster.sol`
**Contracts**: `VulnerablePaymaster`, `VulnerableNonceManager`, `VulnerableSessionKey`, `VulnerableSignatureAggregator`, `VulnerableSocialRecovery`, `VulnerableHardwareWalletDelegation`
**Complexity**: High
**Purpose**: Test ERC-4337 Account Abstraction security detectors (v0.11.0 new detectors)

**Vulnerabilities**:

| Line | Contract | Vulnerability | Severity | Detector IDs | Description |
|------|----------|--------------|----------|--------------|-------------|
| 9-23 | VulnerablePaymaster | Missing Nonce Validation | Critical | `erc4337-paymaster-abuse` | `validatePaymasterUserOp()` has no nonce tracking, enabling replay attacks (Biconomy 2024 exploit pattern) |
| 9-23 | VulnerablePaymaster | No Spending Limit | Critical | `erc4337-paymaster-abuse` | Unlimited sponsorship allows sponsor fund draining |
| 9-23 | VulnerablePaymaster | No Target Whitelist | High | `erc4337-paymaster-abuse` | Missing target validation enables unauthorized transaction sponsorship |
| 9-23 | VulnerablePaymaster | No Gas Limit Validation | High | `erc4337-paymaster-abuse` | Unlimited gas enables ~0.05 ETH griefing attacks |
| 9-23 | VulnerablePaymaster | No Chain ID Binding | Critical | `erc4337-paymaster-abuse` | Cross-chain replay attack possible |
| 26-30 | VulnerablePaymaster | No Spending Limits | Critical | `erc4337-paymaster-abuse` | `sponsorTransaction()` missing validation |
| 33-36 | VulnerablePaymaster | Missing Chain ID | Critical | `cross-chain-replay` | `executeUserOp()` can be replayed across chains |
| 47-50 | VulnerableNonceManager | Sequential Nonce Only | High | `aa-nonce-management` | No nonce key support prevents parallel transactions |
| 52-55 | VulnerableNonceManager | No Key Parameter | Medium | `aa-nonce-management` | `getNonce()` missing key parameter |
| 57-59 | VulnerableNonceManager | No Nonce Invalidation | Medium | `aa-nonce-management` | Missing emergency `invalidateNonce()` function |
| 72-75 | VulnerableSessionKey | No Expiration Time | High | `aa-session-key-security` | Session keys never expire |
| 72-75 | VulnerableSessionKey | No Spending Limits | High | `aa-session-key-security` | Unlimited spending allowed |
| 72-75 | VulnerableSessionKey | No Target Restrictions | High | `aa-session-key-security` | Can call any contract |
| 72-75 | VulnerableSessionKey | No Operation Limits | Medium | `aa-session-key-security` | Unlimited operations |
| 78-89 | VulnerableSessionKey | No Constraint Validation | Critical | `aa-session-key-security` | `executeWithSessionKey()` doesn't check expiration, limits, or restrictions |
| 101-113 | VulnerableSignatureAggregator | No Signature Validation | Critical | `aa-signature-aggregation` | `aggregateSignatures()` simply concatenates without validation |
| 101-113 | VulnerableSignatureAggregator | No Duplicate Prevention | High | `aa-signature-aggregation` | Same signature can be included multiple times |
| 116-122 | VulnerableSignatureAggregator | No Malleability Protection | Critical | `signature-malleability` | `validateAggregatedSignature()` has no actual validation |
| 133-140 | VulnerableSocialRecovery | No Timelock | Critical | `aa-social-recovery` | `initiateRecovery()` allows immediate execution |
| 133-140 | VulnerableSocialRecovery | No Guardian Verification | Critical | `aa-social-recovery` | Missing guardian signature validation |
| 133-140 | VulnerableSocialRecovery | No Minimum Guardian Count | High | `aa-social-recovery` | Single guardian can initiate recovery |
| 143-147 | VulnerableSocialRecovery | Instant Guardian Addition | High | `aa-social-recovery` | `addGuardian()` has no delay or approval |
| 150-154 | VulnerableSocialRecovery | Single Guardian Recovery | Critical | `aa-social-recovery` | `completeRecovery()` has no multi-sig validation |
| 166-169 | VulnerableHardwareWalletDelegation | No Expiration | High | `hardware-wallet-delegation` | `setDelegate()` creates permanent delegation |
| 166-169 | VulnerableHardwareWalletDelegation | No Scope Restrictions | High | `hardware-wallet-delegation` | Delegation has no target or operation restrictions |
| 166-169 | VulnerableHardwareWalletDelegation | No Value Limits | High | `hardware-wallet-delegation` | Unlimited value transfer allowed |
| 172-183 | VulnerableHardwareWalletDelegation | Unlimited Delegation Power | Critical | `hardware-wallet-delegation` | `executeAsDelegate()` has no checks on target, value, or operation type |

**Expected Detections**: 29 issues (6 new AA detectors from v0.11.0)
**Findings Summary**: 14 critical, 12 high, 3 medium, 0 low

**Attack Scenarios**:
- **Paymaster Replay**: Biconomy 2024 pattern - replay UserOperation across sessions/chains
- **Sponsor Draining**: Exceed spending limits to drain paymaster deposits
- **Session Key Abuse**: Permanent session keys with unlimited access
- **Signature Malleability**: Manipulate aggregated signatures
- **Social Recovery Takeover**: Single guardian steals account without timelock
- **Delegation Exploit**: Permanent delegate drains hardware wallet account

**Real-World Exploits**:
- Biconomy AA Exploit (2024) - Nonce bypass via replay attack
- Hardware wallet delegation risks (2024 research)

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/account_abstraction/vulnerable/VulnerablePaymaster.sol
```

---

### 3.2 SecurePaymaster.sol

**Location**: `account_abstraction/secure/SecurePaymaster.sol`
**Contracts**: `SecurePaymaster`, `SecureNonceManager`, `SecureSessionKey`, `SecureSocialRecovery`
**Complexity**: High
**Purpose**: Demonstrate secure ERC-4337 implementation best practices

**Vulnerabilities**: **NONE** (These are secure implementations)

**Security Features**:
- ✅ Nonce tracking with key support for parallel transactions
- ✅ Spending limits validation and enforcement
- ✅ Target whitelist validation
- ✅ Gas limit caps (1,000,000 max)
- ✅ Chain ID binding to prevent cross-chain replay
- ✅ Session key expiration timestamps
- ✅ Session key spending and operation limits
- ✅ Social recovery with multi-sig and timelock (7 days)
- ✅ Minimum 3 guardians requirement
- ✅ Delegation expiration and scope restrictions

**Expected Detections**: 0 issues (any detection is a false positive)
**Findings Summary**: 0 critical, 0 high, 0 medium, 0 low

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/account_abstraction/secure/SecurePaymaster.sol
```

---

## 4. Flash Loan Vulnerabilities

### 4.1 VulnerableFlashLoan.sol

**Location**: `flash_loans/vulnerable/VulnerableFlashLoan.sol`
**Contracts**: `VulnerableOracleFlashLoan`, `VulnerableGovernanceFlashLoan`, `VulnerableFlashMint`, `VulnerableFlashLoanCallback`, `FlashLoanAttacker`
**Complexity**: Very High
**Purpose**: Test flash loan attack detectors (v0.11.0 new detectors)

**Vulnerabilities**:

| Line | Contract | Vulnerability | Severity | Detector IDs | Description |
|------|----------|--------------|----------|--------------|-------------|
| 16-20 | VulnerableOracleFlashLoan | Spot Price Oracle | Critical | `flashloan-oracle-manipulation` | `calculateCollateralValue()` uses spot price without TWAP, manipulable via flash loan (Euler Finance $197M exploit) |
| 23-29 | VulnerableOracleFlashLoan | Manipulable Borrow Price | Critical | `flashloan-oracle-manipulation`, `oracle-manipulation` | `borrow()` decision based on flash-manipulable spot price |
| 32-38 | VulnerableOracleFlashLoan | False Liquidation | Critical | `flashloan-oracle-manipulation`, `oracle-manipulation` | `liquidate()` can be triggered via price manipulation |
| 41-45 | VulnerableOracleFlashLoan | AMM Reserves as Oracle | Critical | `oracle-manipulation` | `getPriceFromPool()` uses spot reserves without TWAP (Mango Markets $110M exploit) |
| 60-72 | VulnerableGovernanceFlashLoan | Flash Loan Voting Power | Critical | `flashloan-governance-attack` | `propose()` based on current balance, exploitable with flash loan (Beanstalk $182M exploit) |
| 75-79 | VulnerableGovernanceFlashLoan | Current Balance Voting | Critical | `flashloan-governance-attack` | `vote()` uses current balance instead of snapshot |
| 82-90 | VulnerableGovernanceFlashLoan | Instant Execution | Critical | `flashloan-governance-attack` | `execute()` has no timelock, same-transaction exploit possible |
| 93-96 | VulnerableGovernanceFlashLoan | Delegation Flash Loan | Critical | `flashloan-governance-attack`, `delegation-loop` | `delegate()` uses current balance for voting power |
| 106-119 | VulnerableFlashMint | Unlimited Flash Mint | Critical | `flashloan-flash-mint` | `flashMint()` has no maximum mint cap |
| 106-119 | VulnerableFlashMint | No Flash Mint Fee | High | `flashloan-flash-mint` | Zero fee enables free supply manipulation |
| 106-119 | VulnerableFlashMint | No Return Validation | Critical | `flashloan-flash-mint` | Missing validation that tokens were returned |
| 122-126 | VulnerableFlashMint | Reward Manipulation | Critical | `flashloan-flash-mint` | `calculateRewards()` uses flash-mintable totalSupply |
| 129-132 | VulnerableFlashMint | Voting Power Manipulation | Critical | `flashloan-flash-mint`, `flashloan-governance-attack` | `getVotingPower()` exploitable via flash mint |
| 145-155 | VulnerableFlashLoanCallback | No Reentrancy Guard | Critical | `flashloan-callback-reentrancy` | `flashLoan()` callback without reentrancy protection |
| 147-151 | VulnerableFlashLoanCallback | State Update After Call | High | `reentrancy` | Balance check after external callback |
| 158-164 | VulnerableFlashLoanCallback | Withdraw During Callback | Critical | `flashloan-callback-reentrancy` | `withdraw()` callable during flash loan callback |
| 167-170 | VulnerableFlashLoanCallback | Nested Flash Loans | High | `flashloan-callback-reentrancy` | `nestedFlashLoan()` allows recursive calls |

**Expected Detections**: 17 issues (4 new Flash Loan detectors from v0.11.0)
**Findings Summary**: 14 critical, 3 high, 0 medium, 0 low

**Attack Scenarios**:
- **Oracle Manipulation**: Take flash loan → manipulate DEX reserves → trigger liquidation → profit from manipulated price
- **Governance Takeover**: Flash loan governance tokens → create malicious proposal → vote → execute in same transaction → repay loan (Beanstalk attack)
- **Flash Mint Rewards**: Flash mint tokens → inflate totalSupply → claim outsized rewards → burn tokens
- **Callback Reentrancy**: Request flash loan → in callback, reenter withdraw → drain funds before validation → repay loan

**Real-World Exploits**:
- **Euler Finance** ($197M, March 2023) - Flash loan oracle manipulation
- **Mango Markets** ($110M, October 2022) - AMM price manipulation
- **Beanstalk** ($182M, April 2022) - Flash loan governance attack
- **Build Finance** ($470K, February 2021) - Flash loan governance takeover

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/flash_loans/vulnerable/VulnerableFlashLoan.sol
```

---

### 4.2 SecureFlashLoan.sol

**Location**: `flash_loans/secure/SecureFlashLoan.sol`
**Contracts**: `SecureOracleFlashLoan`, `SecureGovernanceFlashLoan`, `SecureFlashMint`, `SecureFlashLoanCallback`
**Complexity**: Very High
**Purpose**: Demonstrate secure flash loan-resistant implementations

**Vulnerabilities**: **NONE** (These are secure implementations)

**Security Features**:
- ✅ TWAP oracle (30-minute time-weighted average) instead of spot price
- ✅ Multiple oracle sources (TWAP + Chainlink) with deviation checks (<10%)
- ✅ Governance voting power snapshots at specific blocks
- ✅ Voting delay (1 day) and execution timelock (2 days)
- ✅ Flash mint fee (0.09%) and supply cap (1,000,000 tokens max)
- ✅ Flash mint active flag to block critical operations
- ✅ ReentrancyGuard on flash loan callbacks
- ✅ Checks-effects-interactions pattern
- ✅ Snapshot-based rewards calculation

**Expected Detections**: 0 issues (any detection is a false positive)
**Findings Summary**: 0 critical, 0 high, 0 medium, 0 low

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/flash_loans/secure/SecureFlashLoan.sol
```

---

## 5. Complex Scenarios (2025 Vulnerabilities)

### 5.1 FlashLoanArbitrage.sol

**Location**: `complex_scenarios/2025_vulnerabilities/defi/FlashLoanArbitrage.sol`
**Contract**: `FlashLoanArbitrage`
**Complexity**: High
**Purpose**: Modern DeFi arbitrage vulnerabilities

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 86-99 | No MEV Protection | High | `mev-extractable-value` | `executeArbitrage()` susceptible to frontrunning |
| 91-92 | Price Manipulation | Critical | `oracle-manipulation`, `price-manipulation` | Price calculated before flash loan, can be manipulated |
| 94-95 | State Modification Before External Call | Medium | `reentrancy` | `currentArbitrageAmount` set before external flash loan call |
| 104-140 | Flash Loan Callback Reentrancy | High | `reentrancy`, `flashloan` | Complex reentrancy in `onFlashLoan()` despite ReentrancyGuard |
| 110-111 | Missing Flash Loan Provider Validation | Critical | `external` | No validation that caller is legitimate flash loan provider |
| 116-117 | Real-Time Price Fetching | Critical | `oracle-manipulation` | Prices fetched during execution, vulnerable to MEV |
| 145-155 | Spot Price Usage | Critical | `oracle-manipulation` | Using spot prices without TWAP in `calculatePotentialProfit()` |
| 150-154 | No Slippage Calculation | High | `slippage-protection` | Large trades executed without slippage protection |
| 171-177 | Zero Slippage Protection | Critical | `slippage-protection` | `swapExactTokensForTokens()` with `amountOutMin = 0` |
| 213-220 | Profit Withdrawal Access Control | High | `access-control` | Anyone can withdraw profits (though limited to own balance) |
| 225-228 | Emergency Withdrawal During Flash Loan | Critical | `flashloan` | `emergencyWithdraw()` can steal flash loan funds |
| 252-254 | Unprotected Fallback | Medium | `external` | `receive()` accepts ETH without validation |

**Expected Detections**: 12 issues
**Findings Summary**: 6 critical, 4 high, 2 medium, 0 low
**Attack Scenarios**:
- MEV bot frontruns arbitrage transaction
- Attacker manipulates DEX prices before execution
- Flash loan provider impersonation
- Emergency withdrawal during active flash loan

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/complex_scenarios/2025_vulnerabilities/defi/FlashLoanArbitrage.sol
```

---

### 5.2 DAOGovernance.sol

**Location**: `complex_scenarios/2025_vulnerabilities/governance/DAOGovernance.sol`
**Contract**: `DAOGovernance`
**Complexity**: Very High
**Purpose**: Modern governance attack vectors

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 160 | Flash Loan Governance Attack | Critical | `flashloan`, `governance` | Proposal threshold check bypassable with flash loan |
| 162-163 | No Proposal Cooldown | Medium | `governance` | Same address can create unlimited proposals |
| 196-222 | Signature Replay Attack | Critical | `signature-replay`, `weak-signature-validation` | `castVoteBySig()` has no nonce for replay protection |
| 242 | Current Block Voting Power | Critical | `governance`, `flashloan` | Voting power calculated at current block, not snapshot |
| 246-249 | Vote Delegation Manipulation | High | `delegation-loop`, `governance` | Delegation can be manipulated during active voting |
| 277-278 | ETA Manipulation | Medium | `timestamp-manipulation` | Execution time can be manipulated by admin |
| 294-310 | External Calls in Loop | High | `dos-unbounded-operation` | Multiple external calls without proper error handling |
| 300-308 | Continues on Failure | Medium | `external` | Execution continues even if some calls fail |
| 318-333 | Guardian Cancel Authority | High | `centralization-risk` | Guardian can cancel any proposal |
| 338-359 | Delegation Loop Vulnerability | Critical | `delegation-loop` | No protection against circular delegation |
| 342-343 | No Delegation Timelock | Medium | `governance` | Delegation changes immediate, no cooldown |
| 364-371 | Flash Loan Voting | Critical | `flashloan`, `governance` | Current balance used, no snapshot protection |
| 404-405 | Quorum Manipulation | High | `governance` | Quorum based on current supply, can be manipulated |
| 411-414 | Emergency Pause Abuse | High | `centralization-risk`, `emergency-function-abuse` | No timelock or multi-sig for emergency pause |
| 426-437 | Immediate Parameter Changes | Medium | `governance` | Governance parameters changeable without proposal |
| 442-457 | Cross-Chain State Inconsistency | High | `cross-chain-replay` | No validation of cross-chain state |
| 452-454 | Cross-Chain Message Validation | Critical | `bridge-message-verification` | No verification of cross-chain message authenticity |
| 467 | Unvalidated Fallback | Medium | `external` | `receive()` accepts ETH without validation |

**Expected Detections**: 18 issues
**Findings Summary**: 6 critical, 6 high, 6 medium, 0 low
**Attack Scenarios**:
- Flash loan attack to pass proposal threshold
- Vote with borrowed tokens
- Delegation loop to amplify voting power
- Signature replay across proposals
- Guardian centralization abuse
- Cross-chain governance manipulation

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/complex_scenarios/2025_vulnerabilities/governance/DAOGovernance.sol
```

---

### 5.3 BridgeVault.sol

**Location**: `complex_scenarios/2025_vulnerabilities/cross_chain/BridgeVault.sol`
**Expected Vulnerabilities**: Bridge-specific vulnerabilities (chain ID, message verification, replay attacks)

---

### 5.4 MEVProtectedDEX.sol

**Location**: `complex_scenarios/2025_vulnerabilities/mev/MEVProtectedDEX.sol`
**Expected Vulnerabilities**: MEV protection bypass, sandwich attack vectors, deadline manipulation

---

### 5.5 LiquidityMining.sol

**Location**: `complex_scenarios/2025_vulnerabilities/yield_farming/LiquidityMining.sol`
**Expected Vulnerabilities**: Reward calculation errors, staking manipulation, JIT attacks

---

## 6. Cross-Chain Vulnerabilities

### 6.1 Bridge Chain ID Validation

**Location**: `cross_chain/phase13_legacy/bridge_chain_id/`

#### vulnerable_simple.sol

**Contract**: `VulnerableBridge`
**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 13-22 | Missing Chain-ID Validation | Critical | `bridge-chain-id-validation` | `processMessage()` doesn't validate destination chain |
| 26-37 | No Chain Check | Critical | `bridge-chain-id-validation` | `receiveMessage()` executes without chain validation |

**Expected Detections**: 2 issues
**Findings Summary**: 2 critical, 0 high, 0 medium, 0 low
**Attack**: Message intended for chain A replayed on chain B

#### vulnerable_complex.sol

**Expected**: Multiple chain-ID validation issues with complex bridge logic

#### clean.sol

**Expected**: 0 issues (proper chain-ID validation implemented)

**Test Commands**:
```bash
./target/release/soliditydefend tests/contracts/cross_chain/phase13_legacy/bridge_chain_id/vulnerable_simple.sol
./target/release/soliditydefend tests/contracts/cross_chain/phase13_legacy/bridge_chain_id/vulnerable_complex.sol
./target/release/soliditydefend tests/contracts/cross_chain/phase13_legacy/bridge_chain_id/clean.sol
```

---

### 6.2 Bridge Message Verification

**Location**: `cross_chain/phase13_legacy/bridge_message_verification/`

**Contracts**:
- `vulnerable_simple.sol` - Missing signature/proof verification
- `vulnerable_complex.sol` - Complex verification bypass scenarios
- `test_merkle.sol` - Merkle proof validation issues
- `clean.sol` - Proper message verification

**Expected Vulnerabilities**: Message forgery, missing signature validation, weak proof verification

---

### 6.3 Bridge Token Minting

**Location**: `cross_chain/phase13_legacy/bridge_token_minting/`

**Contracts**:
- `vulnerable_simple.sol` - Unrestricted minting
- `vulnerable_complex.sol` - Complex minting vulnerabilities
- `test_modifier.sol` - Modifier bypass scenarios
- `clean.sol` - Proper minting access control

**Expected Vulnerabilities**: Unauthorized minting, missing access control, bridge role abuse

---

## 7. ERC-4626 Vault Vulnerabilities

### 7.1 Vulnerable Vaults

#### VulnerableVault_Inflation.sol

**Location**: `erc4626_vaults/VulnerableVault_Inflation.sol`
**Contract**: `VulnerableVault_Inflation`
**Complexity**: Medium
**Purpose**: Share inflation attack pattern

**Vulnerabilities**:

| Line | Vulnerability | Severity | Detector IDs | Description |
|------|--------------|----------|--------------|-------------|
| 51-72 | Share Inflation Attack | Critical | `vault-share-inflation` | First depositor can manipulate share price |
| 54-60 | No Minimum Deposit | Critical | `vault-share-inflation` | Allows 1 wei deposit for manipulation |
| 59 | Direct Transfer Manipulation | Critical | `vault-donation-attack` | Uses `balanceOf()` instead of internal accounting |
| 64 | No Share Validation | High | `vault-share-inflation` | Allows zero shares to be minted (rounds down) |
| 94-98 | Total Assets Calculation | Critical | `vault-donation-attack` | `totalAssets()` uses manipulable `balanceOf()` |

**Expected Detections**: 5 issues
**Findings Summary**: 4 critical, 1 high, 0 medium, 0 low
**Attack Scenario**:
1. Attacker deposits 1 wei → receives 1 share
2. Attacker directly transfers 10,000 tokens → inflates share price
3. Victim deposits 20,000 tokens → receives ~1 share (rounds down)
4. Attacker redeems 1 share → gets half of total assets
5. Victim loses ~10,000 tokens to rounding

**Reference**: Cetus DEX exploit (May 2025, $223M)

**Test Command**:
```bash
./target/release/soliditydefend tests/contracts/erc4626_vaults/VulnerableVault_Inflation.sol
```

---

#### VulnerableVault_Donation.sol

**Expected Vulnerabilities**: Donation attack, direct transfer manipulation, share price inflation

---

#### VulnerableVault_FeeManipulation.sol

**Expected Vulnerabilities**: Fee calculation errors, fee bypass, excessive fee extraction

---

#### VulnerableVault_HookReentrancy.sol

**Expected Vulnerabilities**: Hook callback reentrancy, ERC-777/ERC-1155 receiver exploits

---

#### VulnerableVault_WithdrawalDOS.sol

**Expected Vulnerabilities**: Withdrawal denial of service, griefing attacks, queue manipulation

---

### 7.2 Secure Vaults (Mitigation Examples)

#### SecureVault_VirtualShares.sol

**Mitigation**: Uses virtual shares offset to prevent inflation
**Expected Detections**: 0 issues
**Findings Summary**: 0 critical, 0 high, 0 medium, 0 low

---

#### SecureVault_DeadShares.sol

**Mitigation**: Mints dead shares at deployment
**Expected Detections**: 0 issues
**Findings Summary**: 0 critical, 0 high, 0 medium, 0 low

---

#### SecureVault_MinimumDeposit.sol

**Mitigation**: Enforces minimum deposit amount
**Expected Detections**: 0 issues
**Findings Summary**: 0 critical, 0 high, 0 medium, 0 low

---

#### SecureVault_InternalAccounting.sol

**Mitigation**: Uses internal balance tracking instead of `balanceOf()`
**Expected Detections**: 0 issues
**Findings Summary**: 0 critical, 0 high, 0 medium, 0 low

---

## Summary Statistics

### By Category

| Category | Total Contracts | Vulnerable | Clean | Complex |
|----------|----------------|-----------|-------|---------|
| Account Abstraction (NEW v0.11.0) | 2 | 1 | 1 | 1 |
| Basic Vulnerabilities | 3 | 3 | 0 | 0 |
| Clean Examples | 1 | 0 | 1 | 0 |
| Complex Scenarios | 5 | 5 | 0 | 5 |
| Cross-Chain | 14 | 9 | 5 | 4 |
| ERC-4626 Vaults | 9 | 5 | 4 | 2 |
| Flash Loans (NEW v0.11.0) | 2 | 1 | 1 | 1 |
| **TOTAL** | **36** | **24** | **12** | **13** |

### By Severity

| Severity | Count | Percentage |
|----------|-------|-----------|
| Critical | 55+ | 50% |
| High | 35+ | 32% |
| Medium | 18+ | 16% |
| Low | 3+ | 2% |
| **TOTAL** | **111+** | **100%** |

**v0.11.0 Additions:**
- Account Abstraction: +28 vulnerabilities (16 Critical, 10 High, 2 Medium)
- Flash Loans: +18 vulnerabilities (14 Critical, 3 High, 1 Medium)

### By Detector Category

| Category | Vulnerabilities | Key Detectors |
|----------|----------------|---------------|
| **Account Abstraction (NEW)** | **28+** | `erc4337-paymaster-abuse`, `aa-nonce-management`, `aa-session-key-security`, `aa-signature-aggregation`, `aa-social-recovery`, `hardware-wallet-delegation` |
| **Flash Loans (NEW)** | **18+** | `flashloan-oracle-manipulation`, `flashloan-governance-attack`, `flashloan-flash-mint`, `flashloan-callback-reentrancy` |
| Access Control | 8+ | `access-control`, `auth` |
| Reentrancy | 6+ | `reentrancy`, `erc721-callback-reentrancy` |
| DeFi/Oracle | 15+ | `oracle-manipulation`, `price-manipulation`, `flashloan` |
| Governance | 12+ | `governance`, `flashloan`, `delegation-loop` |
| Cross-Chain | 10+ | `bridge-chain-id-validation`, `bridge-message-verification`, `cross-chain-replay` |
| ERC-4626 Vaults | 8+ | `vault-share-inflation`, `vault-donation-attack`, `vault-hook-reentrancy` |
| MEV | 6+ | `mev-extractable-value`, `slippage-protection`, `front-running-mitigation` |
| Validation | 8+ | `missing-input-validation`, `zero-address`, `array-bounds` |
| External Calls | 5+ | `external`, `dangerous-delegatecall` |

---

## Testing Methodology

### Full Suite Test

Run all test contracts:
```bash
find tests/contracts -name "*.sol" -type f | while read contract; do
    echo "Testing: $contract"
    ./target/release/soliditydefend "$contract" --format json > "results/$(basename $contract .sol).json"
done
```

### Category Tests

```bash
# Basic vulnerabilities
./target/release/soliditydefend tests/contracts/basic_vulnerabilities/*.sol

# Clean examples (should have 0 detections)
./target/release/soliditydefend tests/contracts/clean_examples/*.sol

# Complex scenarios
./target/release/soliditydefend tests/contracts/complex_scenarios/2025_vulnerabilities/*/*.sol

# ERC-4626 vaults
./target/release/soliditydefend tests/contracts/erc4626_vaults/*.sol
```

### Comparison Analysis

1. **Run SolidityDefend**:
   ```bash
   ./target/release/soliditydefend <contract.sol> --format json > actual.json
   ```

2. **Compare with this inventory**:
   - Check if all documented vulnerabilities are detected
   - Check for false positives (detections not in inventory)
   - Check for false negatives (inventory items not detected)

3. **Calculate metrics**:
   - True Positives (TP): Correctly detected vulnerabilities
   - False Positives (FP): Incorrect detections
   - False Negatives (FN): Missed vulnerabilities
   - Precision: TP / (TP + FP)
   - Recall: TP / (TP + FN)
   - F1 Score: 2 * (Precision * Recall) / (Precision + Recall)

---

## Updating This Inventory

When adding new test contracts:

1. Create the contract in appropriate subdirectory
2. Add entry to this inventory with:
   - File location and contract name
   - Complexity level
   - Purpose/focus
   - Detailed vulnerability table
   - Expected detection count
   - Test command
   - Attack scenarios (if applicable)
3. Update summary statistics
4. Run validation to ensure documented vulnerabilities match code

---

## Notes

- **Line numbers** may shift if contracts are modified. Always verify against current code.
- **Detector IDs** are from SolidityDefend v1.0.0. Check `--list-detectors` for current IDs.
- **Severity levels** are estimates. Actual severity depends on context.
- **Expected detections** are minimum counts. Detectors may find additional related issues.
- Some contracts have **intentional vulnerabilities** for testing. DO NOT use in production.

---

**Maintained by**: SolidityDefend Development Team
**Version**: 1.1
**Last Verified**: v0.11.1 release (October 27, 2025)
