<?xml version="1.0" encoding="UTF-8"?>
<idea-plugin>
    <id>com.soliditydefend.intellij</id>
    <name>SolidityDefend</name>
    <version>1.0.0</version>
    <vendor email="support@soliditydefend.dev" url="https://soliditydefend.dev">SolidityDefend</vendor>

    <description><![CDATA[
        Advanced security analysis for Solidity smart contracts in IntelliJ IDEA.

        Features:
        - Real-time vulnerability detection
        - Comprehensive security analysis
        - Code fixes and refactoring suggestions
        - DeFi-specific vulnerability detection
        - Cross-contract analysis
        - Taint analysis for data flow tracking
        - Interactive security reports

        Integrates with the SolidityDefend analysis engine to provide comprehensive security insights directly in your IDE.
    ]]></description>

    <change-notes><![CDATA[
        <h3>Version 1.0.0</h3>
        <ul>
            <li>Initial release</li>
            <li>Real-time security analysis</li>
            <li>Code highlighting and inspection</li>
            <li>Quick fixes for common vulnerabilities</li>
            <li>Integration with SolidityDefend LSP server</li>
        </ul>
    ]]></change-notes>

    <!-- IntelliJ IDEA minimum version -->
    <idea-version since-build="203"/>

    <!-- Plugin dependencies -->
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.lang</depends>

    <!-- Application components -->
    <application-components>
        <component>
            <implementation-class>com.soliditydefend.intellij.SolidityDefendApplicationComponent</implementation-class>
        </component>
    </application-components>

    <!-- Project components -->
    <project-components>
        <component>
            <implementation-class>com.soliditydefend.intellij.SolidityDefendProjectComponent</implementation-class>
        </component>
    </project-components>

    <extensions defaultExtensionNs="com.intellij">
        <!-- Language support -->
        <fileType
            name="Solidity"
            implementationClass="com.soliditydefend.intellij.SolidityFileType"
            fieldName="INSTANCE"
            language="Solidity"
            extensions="sol"/>

        <lang.parserDefinition
            language="Solidity"
            implementationClass="com.soliditydefend.intellij.SolidityParserDefinition"/>

        <lang.syntaxHighlighterFactory
            language="Solidity"
            implementationClass="com.soliditydefend.intellij.SoliditySyntaxHighlighterFactory"/>

        <!-- Security analysis -->
        <localInspection
            language="Solidity"
            displayName="Security Vulnerabilities"
            groupName="SolidityDefend"
            enabledByDefault="true"
            level="ERROR"
            implementationClass="com.soliditydefend.intellij.inspections.SecurityInspection"/>

        <localInspection
            language="Solidity"
            displayName="Reentrancy Detection"
            groupName="SolidityDefend"
            enabledByDefault="true"
            level="ERROR"
            implementationClass="com.soliditydefend.intellij.inspections.ReentrancyInspection"/>

        <localInspection
            language="Solidity"
            displayName="Access Control Issues"
            groupName="SolidityDefend"
            enabledByDefault="true"
            level="WARNING"
            implementationClass="com.soliditydefend.intellij.inspections.AccessControlInspection"/>

        <localInspection
            language="Solidity"
            displayName="Gas Optimization"
            groupName="SolidityDefend"
            enabledByDefault="true"
            level="WEAK WARNING"
            implementationClass="com.soliditydefend.intellij.inspections.GasOptimizationInspection"/>

        <!-- Code completion -->
        <completion.contributor
            language="Solidity"
            implementationClass="com.soliditydefend.intellij.completion.SecurityPatternCompletionContributor"/>

        <!-- Quick fixes -->
        <intentionAction>
            <className>com.soliditydefend.intellij.intentions.AddReentrancyGuardIntention</className>
            <category>SolidityDefend</category>
        </intentionAction>

        <intentionAction>
            <className>com.soliditydefend.intellij.intentions.AddAccessControlIntention</className>
            <category>SolidityDefend</category>
        </intentionAction>

        <intentionAction>
            <className>com.soliditydefend.intellij.intentions.ReplaceTxOriginIntention</className>
            <category>SolidityDefend</category>
        </intentionAction>

        <!-- Tool windows -->
        <toolWindow
            id="SolidityDefend"
            anchor="right"
            factoryClass="com.soliditydefend.intellij.toolwindows.SecurityToolWindowFactory"
            icon="/icons/soliditydefend.png"/>

        <!-- Actions -->
        <action
            id="SolidityDefend.AnalyzeFile"
            class="com.soliditydefend.intellij.actions.AnalyzeFileAction"
            text="Analyze Current File"
            description="Analyze the current Solidity file for security vulnerabilities">
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </action>

        <action
            id="SolidityDefend.AnalyzeProject"
            class="com.soliditydefend.intellij.actions.AnalyzeProjectAction"
            text="Analyze Project"
            description="Analyze all Solidity files in the project">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <action
            id="SolidityDefend.ExportReport"
            class="com.soliditydefend.intellij.actions.ExportReportAction"
            text="Export Security Report"
            description="Export security analysis report">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Configuration -->
        <projectConfigurable
            instance="com.soliditydefend.intellij.settings.SolidityDefendConfigurable"
            displayName="SolidityDefend"
            id="SolidityDefend.Settings"/>

        <!-- Error reporting -->
        <errorHandler implementation="com.soliditydefend.intellij.SolidityDefendErrorReporter"/>

        <!-- Live templates -->
        <liveTemplateContext implementation="com.soliditydefend.intellij.templates.SolidityContext"/>

        <!-- External annotator for LSP integration -->
        <externalAnnotator
            language="Solidity"
            implementationClass="com.soliditydefend.intellij.annotators.SecurityAnnotator"/>

        <!-- Document formatting -->
        <formattingService implementation="com.soliditydefend.intellij.formatting.SolidityFormattingService"/>

        <!-- Code style settings -->
        <codeStyleSettingsProvider implementation="com.soliditydefend.intellij.formatting.SolidityCodeStyleSettingsProvider"/>

        <!-- Structure view -->
        <lang.psiStructureViewFactory
            language="Solidity"
            implementationClass="com.soliditydefend.intellij.structureView.SolidityStructureViewFactory"/>

        <!-- Find usages -->
        <lang.findUsagesProvider
            language="Solidity"
            implementationClass="com.soliditydefend.intellij.findUsages.SolidityFindUsagesProvider"/>

        <!-- Breadcrumbs -->
        <breadcrumbsInfoProvider implementation="com.soliditydefend.intellij.breadcrumbs.SolidityBreadcrumbsProvider"/>
    </extensions>

    <actions>
        <group id="SolidityDefend.Menu" text="SolidityDefend" popup="true">
            <add-to-group group-id="MainMenu" anchor="before" relative-to-action="HelpMenu"/>

            <action id="SolidityDefend.QuickAnalysis"
                    class="com.soliditydefend.intellij.actions.QuickAnalysisAction"
                    text="Quick Security Analysis"
                    description="Perform quick security analysis on current file"/>

            <action id="SolidityDefend.FullAnalysis"
                    class="com.soliditydefend.intellij.actions.FullAnalysisAction"
                    text="Full Project Analysis"
                    description="Perform comprehensive security analysis on entire project"/>

            <separator/>

            <action id="SolidityDefend.GenerateReport"
                    class="com.soliditydefend.intellij.actions.GenerateReportAction"
                    text="Generate Security Report"
                    description="Generate detailed security analysis report"/>

            <action id="SolidityDefend.ViewDashboard"
                    class="com.soliditydefend.intellij.actions.ViewDashboardAction"
                    text="Open Web Dashboard"
                    description="Open SolidityDefend web dashboard"/>

            <separator/>

            <action id="SolidityDefend.Settings"
                    class="com.soliditydefend.intellij.actions.OpenSettingsAction"
                    text="Settings"
                    description="Open SolidityDefend settings"/>
        </group>

        <!-- Editor context menu -->
        <group id="SolidityDefend.EditorPopup">
            <action id="SolidityDefend.AnalyzeSelection"
                    class="com.soliditydefend.intellij.actions.AnalyzeSelectionAction"
                    text="Analyze Selection"
                    description="Analyze selected code for security issues"/>
            <add-to-group group-id="EditorPopupMenu" anchor="first"/>
        </group>

        <!-- Project view context menu -->
        <group id="SolidityDefend.ProjectViewPopup">
            <action id="SolidityDefend.AnalyzeDirectory"
                    class="com.soliditydefend.intellij.actions.AnalyzeDirectoryAction"
                    text="Analyze with SolidityDefend"
                    description="Analyze directory for security vulnerabilities"/>
            <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
        </group>
    </actions>

    <!-- Startup activities -->
    <extensions defaultExtensionNs="com.intellij">
        <postStartupActivity implementation="com.soliditydefend.intellij.startup.SolidityDefendStartupActivity"/>
    </extensions>
</idea-plugin>