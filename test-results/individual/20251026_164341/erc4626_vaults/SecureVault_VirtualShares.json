Loaded configuration from: .soliditydefend.yml
Starting analysis...
Analyzing: /Users/pwner/Git/ABS/SolidityDefend/tests/contracts/erc4626_vaults/SecureVault_VirtualShares.sol
  Found 39 issues
{
  "version": "0.8.0",
  "timestamp": "2025-10-26T22:43:45.513360Z",
  "findings": [
    {
      "detector_id": "inefficient-storage",
      "message": "Inefficient storage pattern detected. Function 'redeem' reads same storage variable multiple times. Cache in memory Inefficient storage layout increases gas costs for all state-modifying operations.",
      "severity": "low",
      "location": {
        "line": 59,
        "column": 0,
        "length": 30
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Optimize storage layout. Consider: (1) Pack variables <32 bytes together in structs, (2) Order struct fields by size (largest to smallest), (3) Use uint256 instead of smaller types for standalone variables, (4) Combine boolean flags into a single uint256 bitmap, (5) Use constants/immutables for unchanging values.",
        "replacements": []
      }
    },
    {
      "detector_id": "floating-pragma",
      "message": "Floating pragma detected: pragma solidity ^0.8.0;. Using '^' allows compilation with multiple compiler versions, which may introduce unexpected behavior or security vulnerabilities. Different compiler versions may have different bugs, optimizations, or security fixes.",
      "severity": "low",
      "location": {
        "line": 2,
        "column": 0,
        "length": 23
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Lock pragma to specific version: 'pragma solidity 0.8.0;'. This ensures consistent compilation across environments and prevents unexpected behavior from compiler version differences.",
        "replacements": []
      }
    },
    {
      "detector_id": "missing-zero-address-check",
      "message": "Address parameter '_asset' in function '' is not checked for zero address",
      "severity": "low",
      "location": {
        "line": 33,
        "column": 25,
        "length": 6
      },
      "cwe": "CWE-476",
      "fix_suggestion": {
        "description": "Add require(_asset != address(0), \"Zero address not allowed\");",
        "replacements": []
      }
    },
    {
      "detector_id": "missing-zero-address-check",
      "message": "Address parameter 'receiver' in function 'deposit' is not checked for zero address",
      "severity": "high",
      "location": {
        "line": 41,
        "column": 46,
        "length": 8
      },
      "cwe": "CWE-476",
      "fix_suggestion": {
        "description": "Add require(receiver != address(0), \"Zero address not allowed\");",
        "replacements": []
      }
    },
    {
      "detector_id": "missing-zero-address-check",
      "message": "Address parameter 'receiver' in function 'redeem' is not checked for zero address",
      "severity": "medium",
      "location": {
        "line": 59,
        "column": 45,
        "length": 8
      },
      "cwe": "CWE-476",
      "fix_suggestion": {
        "description": "Add require(receiver != address(0), \"Zero address not allowed\");",
        "replacements": []
      }
    },
    {
      "detector_id": "missing-zero-address-check",
      "message": "Address parameter 'owner' in function 'redeem' is not checked for zero address",
      "severity": "high",
      "location": {
        "line": 59,
        "column": 63,
        "length": 5
      },
      "cwe": "CWE-476",
      "fix_suggestion": {
        "description": "Add require(owner != address(0), \"Zero address not allowed\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter '_asset' of type 'address' may need validation",
      "severity": "low",
      "location": {
        "line": 33,
        "column": 25,
        "length": 6
      },
      "cwe": "CWE-20",
      "fix_suggestion": {
        "description": "require(_asset != address(0), \"Invalid address\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'receiver' of type 'address' may need validation",
      "severity": "low",
      "location": {
        "line": 41,
        "column": 46,
        "length": 8
      },
      "cwe": "CWE-20",
      "fix_suggestion": {
        "description": "require(receiver != address(0), \"Invalid address\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'receiver' is declared but never used",
      "severity": "medium",
      "location": {
        "line": 41,
        "column": 46,
        "length": 8
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused parameter 'receiver' or use it in the function",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'receiver' of type 'address' may need validation",
      "severity": "low",
      "location": {
        "line": 59,
        "column": 45,
        "length": 8
      },
      "cwe": "CWE-20",
      "fix_suggestion": {
        "description": "require(receiver != address(0), \"Invalid address\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'owner' of type 'address' may need validation",
      "severity": "high",
      "location": {
        "line": 59,
        "column": 63,
        "length": 5
      },
      "cwe": "CWE-20",
      "fix_suggestion": {
        "description": "require(owner != address(0), \"Invalid address\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'owner' in function 'redeem' may shadow a state variable",
      "severity": "medium",
      "location": {
        "line": 59,
        "column": 63,
        "length": 5
      },
      "cwe": "CWE-1177",
      "fix_suggestion": {
        "description": "Consider renaming parameter 'owner' to avoid shadowing",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'assets' is declared but never used",
      "severity": "medium",
      "location": {
        "line": 83,
        "column": 39,
        "length": 6
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused parameter 'assets' or use it in the function",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'shares' is declared but never used",
      "severity": "medium",
      "location": {
        "line": 95,
        "column": 39,
        "length": 6
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused parameter 'shares' or use it in the function",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'assets' is declared but never used",
      "severity": "medium",
      "location": {
        "line": 105,
        "column": 37,
        "length": 6
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused parameter 'assets' or use it in the function",
        "replacements": []
      }
    },
    {
      "detector_id": "vault-withdrawal-dos",
      "message": "Function 'redeem' is vulnerable to withdrawal DOS attack. Withdrawal requires successful external call. Failing calls can permanently block withdrawals. Consider using pull-over-push pattern Attacker can block withdrawals, causing funds to be locked indefinitely.",
      "severity": "high",
      "location": {
        "line": 59,
        "column": 14,
        "length": 6
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Protect 'redeem' from withdrawal DOS. Solutions: (1) Implement withdrawal limits/caps per transaction, (2) Add circuit breakers for emergency withdrawals, (3) Avoid unbounded loops in withdrawal queue processing, (4) Implement partial withdrawal support, (5) Use pull-over-push pattern for failed withdrawals.",
        "replacements": []
      }
    },
    {
      "detector_id": "block-stuffing-vulnerable",
      "message": "Function 'deposit' is vulnerable to block stuffing attacks. First-come-first-served mechanism with strict ordering, attackers can stuff blocks to prevent others from participating Attackers can fill blocks with transactions to prevent legitimate users from executing time-sensitive operations.",
      "severity": "high",
      "location": {
        "line": 41,
        "column": 14,
        "length": 7
      },
      "cwe": "CWE-362",
      "fix_suggestion": {
        "description": "Mitigate block stuffing in 'deposit'. Implement: (1) Grace periods extending deadlines, (2) Multi-block operation windows, (3) Commit-reveal with extended reveal period, (4) Allow batch processing across multiple blocks, (5) Emergency pause mechanisms.",
        "replacements": []
      }
    },
    {
      "detector_id": "withdrawal-delay",
      "message": "Function 'redeem' has withdrawal delay vulnerability. Withdrawal requires successful external call, failing calls can permanently block withdrawals Improper withdrawal mechanisms can lock user funds indefinitely or enable denial of service.",
      "severity": "high",
      "location": {
        "line": 59,
        "column": 14,
        "length": 6
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Fix withdrawal mechanism in 'redeem'. Implement maximum withdrawal delay caps, add emergency withdrawal options with penalties, prevent admin from extending delays arbitrarily, implement fair queue systems, add partial withdrawal capabilities, and document clear withdrawal timelines.",
        "replacements": []
      }
    },
    {
      "detector_id": "token-supply-manipulation",
      "message": "Function 'deposit' has token supply manipulation vulnerability. Function directly modifies totalSupply variable, bypasses mint/burn controls for supply manipulation Improper supply controls can lead to unlimited minting, hyperinflation, or complete token devaluation.",
      "severity": "critical",
      "location": {
        "line": 41,
        "column": 14,
        "length": 7
      },
      "cwe": "CWE-682",
      "fix_suggestion": {
        "description": "Fix token supply controls in 'deposit'. Implement maximum supply cap, add minting rate limits, require multi-signature for minting, add supply change events, validate burn amounts, and implement supply monitoring.",
        "replacements": []
      }
    },
    {
      "detector_id": "token-supply-manipulation",
      "message": "Function 'redeem' has token supply manipulation vulnerability. Function directly modifies totalSupply variable, bypasses mint/burn controls for supply manipulation Improper supply controls can lead to unlimited minting, hyperinflation, or complete token devaluation.",
      "severity": "critical",
      "location": {
        "line": 59,
        "column": 14,
        "length": 6
      },
      "cwe": "CWE-682",
      "fix_suggestion": {
        "description": "Fix token supply controls in 'redeem'. Implement maximum supply cap, add minting rate limits, require multi-signature for minting, add supply change events, validate burn amounts, and implement supply monitoring.",
        "replacements": []
      }
    },
    {
      "detector_id": "gas-griefing",
      "message": "Function 'deposit' has gas griefing vulnerability. Transfer without gas stipend, recipient can grief by consuming gas in fallback Attackers can force users to waste gas or cause transactions to fail.",
      "severity": "medium",
      "location": {
        "line": 41,
        "column": 14,
        "length": 7
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Mitigate gas griefing in 'deposit'. Use pull pattern for transfers, limit array sizes, add gas stipends, implement gas-efficient loops, avoid unbounded operations, use OpenZeppelin SafeERC20.",
        "replacements": []
      }
    },
    {
      "detector_id": "gas-griefing",
      "message": "Function 'redeem' has gas griefing vulnerability. Transfer without gas stipend, recipient can grief by consuming gas in fallback Attackers can force users to waste gas or cause transactions to fail.",
      "severity": "medium",
      "location": {
        "line": 59,
        "column": 14,
        "length": 6
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Mitigate gas griefing in 'redeem'. Use pull pattern for transfers, limit array sizes, add gas stipends, implement gas-efficient loops, avoid unbounded operations, use OpenZeppelin SafeERC20.",
        "replacements": []
      }
    },
    {
      "detector_id": "excessive-gas-usage",
      "message": "Function 'redeem' contains excessive gas usage pattern. Multiple storage reads detected (7). Cache in memory variable to save gas Excessive gas usage increases transaction costs and may cause out-of-gas errors.",
      "severity": "low",
      "location": {
        "line": 59,
        "column": 14,
        "length": 6
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Optimize gas usage in 'redeem'. Consider: (1) Move storage operations outside loops, (2) Cache storage reads in memory, (3) Use events instead of storage for historical data, (4) Pack struct variables efficiently, (5) Use memory arrays for temporary data.",
        "replacements": []
      }
    },
    {
      "detector_id": "inefficient-storage",
      "message": "Inefficient storage pattern detected. Function 'redeem' reads same storage variable multiple times. Cache in memory Inefficient storage layout increases gas costs for all state-modifying operations.",
      "severity": "low",
      "location": {
        "line": 59,
        "column": 0,
        "length": 30
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Optimize storage layout. Consider: (1) Pack variables <32 bytes together in structs, (2) Order struct fields by size (largest to smallest), (3) Use uint256 instead of smaller types for standalone variables, (4) Combine boolean flags into a single uint256 bitmap, (5) Use constants/immutables for unchanging values.",
        "replacements": []
      }
    },
    {
      "detector_id": "front-running-mitigation",
      "message": "Function 'deposit' lacks front-running protection. Function 'deposit' performs high-value state changes observable in mempool. Consider commit-reveal or private transactions Front-runners can extract MEV by observing mempool and inserting their transactions before yours.",
      "severity": "high",
      "location": {
        "line": 41,
        "column": 14,
        "length": 7
      },
      "cwe": "CWE-362",
      "fix_suggestion": {
        "description": "Add front-running protection to 'deposit'. Implement: (1) Commit-reveal scheme with time delay, (2) Deadline parameter for transaction validity, (3) Minimum output amount (slippage protection), (4) Batch auctions or frequent batch auctions (FBA), (5) Private mempool (Flashbots Protect), (6) Time-weighted average pricing (TWAP).",
        "replacements": []
      }
    },
    {
      "detector_id": "front-running-mitigation",
      "message": "Function 'redeem' lacks front-running protection. Function 'redeem' performs high-value state changes observable in mempool. Consider commit-reveal or private transactions Front-runners can extract MEV by observing mempool and inserting their transactions before yours.",
      "severity": "high",
      "location": {
        "line": 59,
        "column": 14,
        "length": 6
      },
      "cwe": "CWE-362",
      "fix_suggestion": {
        "description": "Add front-running protection to 'redeem'. Implement: (1) Commit-reveal scheme with time delay, (2) Deadline parameter for transaction validity, (3) Minimum output amount (slippage protection), (4) Batch auctions or frequent batch auctions (FBA), (5) Private mempool (Flashbots Protect), (6) Time-weighted average pricing (TWAP).",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function 'deposit' contains variable shadowing. Local variable 'assets),' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 41,
        "column": 14,
        "length": 7
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in 'deposit'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function '_convertToShares' contains variable shadowing. Parameter 'totalSupply' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 83,
        "column": 14,
        "length": 16
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in '_convertToShares'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function '_convertToShares' contains variable shadowing. Local variable 'supply' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 83,
        "column": 14,
        "length": 16
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in '_convertToShares'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function '_convertToShares' contains variable shadowing. Local variable 'assetBalance' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 83,
        "column": 14,
        "length": 16
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in '_convertToShares'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function '_convertToAssets' contains variable shadowing. Local variable 'supply' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 95,
        "column": 14,
        "length": 16
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in '_convertToAssets'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function '_convertToAssets' contains variable shadowing. Local variable 'assetBalance' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 95,
        "column": 14,
        "length": 16
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in '_convertToAssets'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "defi-yield-farming-exploits",
      "message": "No first depositor protection (inflation attack on vault initialization) in 'deposit'",
      "severity": "critical",
      "location": {
        "line": 41,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Lock initial shares: if (totalSupply() == 0) { _mint(address(0), INITIAL_SHARES); }",
        "replacements": []
      }
    },
    {
      "detector_id": "defi-yield-farming-exploits",
      "message": "No deposit cap (unlimited exposure risk) in 'deposit'",
      "severity": "low",
      "location": {
        "line": 41,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Add cap: require(totalAssets() + amount <= depositCap, \"Cap exceeded\");",
        "replacements": []
      }
    },
    {
      "detector_id": "defi-yield-farming-exploits",
      "message": "No withdrawal fee accounting (fee bypass risk) in 'redeem'",
      "severity": "medium",
      "location": {
        "line": 59,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Calculate fee: uint256 fee = (amount * withdrawalFee) / FEE_DENOMINATOR; uint256 amountAfterFee = amount - fee;",
        "replacements": []
      }
    },
    {
      "detector_id": "defi-yield-farming-exploits",
      "message": "No validation for zero assets on withdrawal in 'redeem'",
      "severity": "medium",
      "location": {
        "line": 59,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Validate assets: require(assets > 0, \"Assets must be non-zero\");",
        "replacements": []
      }
    },
    {
      "detector_id": "defi-yield-farming-exploits",
      "message": "No first depositor protection (inflation attack on vault initialization) in 'previewDeposit'",
      "severity": "critical",
      "location": {
        "line": 105,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Lock initial shares: if (totalSupply() == 0) { _mint(address(0), INITIAL_SHARES); }",
        "replacements": []
      }
    },
    {
      "detector_id": "defi-yield-farming-exploits",
      "message": "No deposit cap (unlimited exposure risk) in 'previewDeposit'",
      "severity": "low",
      "location": {
        "line": 105,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Add cap: require(totalAssets() + amount <= depositCap, \"Cap exceeded\");",
        "replacements": []
      }
    },
    {
      "detector_id": "floating-pragma",
      "message": "Floating pragma detected: pragma solidity ^0.8.0;. Using '^' allows compilation with multiple compiler versions, which may introduce unexpected behavior or security vulnerabilities. Different compiler versions may have different bugs, optimizations, or security fixes.",
      "severity": "low",
      "location": {
        "line": 2,
        "column": 0,
        "length": 23
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Lock pragma to specific version: 'pragma solidity 0.8.0;'. This ensures consistent compilation across environments and prevents unexpected behavior from compiler version differences.",
        "replacements": []
      }
    }
  ],
  "metadata": {
    "tool_name": "SolidityDefend",
    "tool_version": "0.8.0",
    "scan_type": "static_analysis",
    "language": "solidity",
    "rules_version": "0.8.0"
  },
  "statistics": {
    "total_findings": 39,
    "severity_counts": {
      "high": 8,
      "critical": 4,
      "low": 11,
      "info": 0,
      "medium": 16
    },
    "unique_detectors": 13
  }
}

Analysis complete:
  Files analyzed: 1
  Successful: 1
  Issues found: 39
  Time taken: 0.01s

Exiting with code 1 due to:
  - Found high or critical severity issues
