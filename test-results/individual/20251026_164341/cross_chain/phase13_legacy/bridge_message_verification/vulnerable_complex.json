Loaded configuration from: .soliditydefend.yml
Starting analysis...
Analyzing: /Users/pwner/Git/ABS/SolidityDefend/tests/contracts/cross_chain/phase13_legacy/bridge_message_verification/vulnerable_complex.sol
  Found 31 issues
{
  "version": "0.8.0",
  "timestamp": "2025-10-26T22:43:44.672539Z",
  "findings": [
    {
      "detector_id": "missing-zero-address-check",
      "message": "Address parameter '_signer' in function '' is not checked for zero address",
      "severity": "low",
      "location": {
        "line": 13,
        "column": 25,
        "length": 7
      },
      "cwe": "CWE-476",
      "fix_suggestion": {
        "description": "Add require(_signer != address(0), \"Zero address not allowed\");",
        "replacements": []
      }
    },
    {
      "detector_id": "array-bounds-check",
      "message": "Array access to 'proof' may be out of bounds - index not validated",
      "severity": "high",
      "location": {
        "line": 66,
        "column": 69,
        "length": 8
      },
      "cwe": "CWE-125",
      "fix_suggestion": {
        "description": "Add bounds check: require(index < proof.length, \"Index out of bounds\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter '_signer' of type 'address' may need validation",
      "severity": "low",
      "location": {
        "line": 13,
        "column": 25,
        "length": 7
      },
      "cwe": "CWE-20",
      "fix_suggestion": {
        "description": "require(_signer != address(0), \"Invalid address\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'proof' of type 'array' may need validation",
      "severity": "medium",
      "location": {
        "line": 45,
        "column": 28,
        "length": 5
      },
      "cwe": "CWE-20",
      "fix_suggestion": {
        "description": "require(proof.length > 0, \"Array cannot be empty\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'proof' of type 'array' may need validation",
      "severity": "medium",
      "location": {
        "line": 62,
        "column": 28,
        "length": 5
      },
      "cwe": "CWE-20",
      "fix_suggestion": {
        "description": "require(proof.length > 0, \"Array cannot be empty\");",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'root' is declared but never used",
      "severity": "medium",
      "location": {
        "line": 60,
        "column": 17,
        "length": 4
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused parameter 'root' or use it in the function",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'proof' is declared but never used",
      "severity": "medium",
      "location": {
        "line": 62,
        "column": 28,
        "length": 5
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused parameter 'proof' or use it in the function",
        "replacements": []
      }
    },
    {
      "detector_id": "parameter-consistency",
      "message": "Parameter 'message' is declared but never used",
      "severity": "medium",
      "location": {
        "line": 71,
        "column": 45,
        "length": 7
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused parameter 'message' or use it in the function",
        "replacements": []
      }
    },
    {
      "detector_id": "test-governance",
      "message": "Function 'executeWithProof' lacks time-delay protection for governance actions. New token holders can immediately use their voting power, enabling flash loan governance attacks.",
      "severity": "medium",
      "location": {
        "line": 42,
        "column": 0,
        "length": 16
      },
      "cwe": "CWE-662",
      "fix_suggestion": {
        "description": "Implement time-delayed voting rights requiring minimum holding periods.",
        "replacements": []
      }
    },
    {
      "detector_id": "test-governance",
      "message": "Function '_executeMessage' lacks time-delay protection for governance actions. New token holders can immediately use their voting power, enabling flash loan governance attacks.",
      "severity": "medium",
      "location": {
        "line": 71,
        "column": 0,
        "length": 15
      },
      "cwe": "CWE-662",
      "fix_suggestion": {
        "description": "Implement time-delayed voting rights requiring minimum holding periods.",
        "replacements": []
      }
    },
    {
      "detector_id": "signature-malleability",
      "message": "Function 'processMessage' uses ECDSA signature verification without malleability protection. Uses ecrecover without checking 's' value against secp256k1 curve order ECDSA signatures have two valid forms (s and -s mod n). Without checking that s is in the lower half range, attackers can create alternate valid signatures for replay attacks.",
      "severity": "high",
      "location": {
        "line": 19,
        "column": 14,
        "length": 14
      },
      "cwe": "CWE-347",
      "fix_suggestion": {
        "description": "Add signature malleability check in 'processMessage'. Use OpenZeppelin's ECDSA library or add: `require(uint256(s) <= 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0, \"Invalid signature 's' value\");` This ensures s is in the lower half of the curve order.",
        "replacements": []
      }
    },
    {
      "detector_id": "circular-dependency",
      "message": "Function 'executeWithProof' has circular dependency vulnerability. External contract calls without depth limit, circular calls can cause stack overflow Circular dependencies can cause stack overflow, DOS attacks, or make contracts unupgradeable.",
      "severity": "high",
      "location": {
        "line": 42,
        "column": 14,
        "length": 16
      },
      "cwe": "CWE-674",
      "fix_suggestion": {
        "description": "Break circular dependency in 'executeWithProof'. Use events instead of callbacks, implement depth limits for recursive calls, add reentrancy guards, use pull pattern instead of push, implement circuit breakers, and add visited tracking for graph traversal.",
        "replacements": []
      }
    },
    {
      "detector_id": "dos-unbounded-operation",
      "message": "Function 'verifyMerkleProof' has DOS vulnerability via unbounded operation. Loop over unbounded array without iteration limit, large arrays cause out-of-gas Can cause out-of-gas errors blocking contract functionality.",
      "severity": "high",
      "location": {
        "line": 59,
        "column": 14,
        "length": 17
      },
      "cwe": "CWE-834",
      "fix_suggestion": {
        "description": "Fix unbounded operation in 'verifyMerkleProof'. Add pagination for large loops, implement maximum iteration limits, use pull pattern instead of push, add circuit breakers, batch operations.",
        "replacements": []
      }
    },
    {
      "detector_id": "excessive-gas-usage",
      "message": "Function 'verifyMerkleProof' contains excessive gas usage pattern. Storage write operation inside loop. Consider using memory array Excessive gas usage increases transaction costs and may cause out-of-gas errors.",
      "severity": "low",
      "location": {
        "line": 59,
        "column": 14,
        "length": 17
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Optimize gas usage in 'verifyMerkleProof'. Consider: (1) Move storage operations outside loops, (2) Cache storage reads in memory, (3) Use events instead of storage for historical data, (4) Pack struct variables efficiently, (5) Use memory arrays for temporary data.",
        "replacements": []
      }
    },
    {
      "detector_id": "excessive-gas-usage",
      "message": "Function 'verifyMerkleProof' contains excessive gas usage pattern. Array length read in every loop iteration. Cache length in local variable Excessive gas usage increases transaction costs and may cause out-of-gas errors.",
      "severity": "low",
      "location": {
        "line": 59,
        "column": 14,
        "length": 17
      },
      "cwe": "CWE-400",
      "fix_suggestion": {
        "description": "Optimize gas usage in 'verifyMerkleProof'. Consider: (1) Move storage operations outside loops, (2) Cache storage reads in memory, (3) Use events instead of storage for historical data, (4) Pack struct variables efficiently, (5) Use memory arrays for temporary data.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function 'processMessage' contains variable shadowing. Local variable 'signer' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 19,
        "column": 14,
        "length": 14
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in 'processMessage'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function 'executeWithProof' contains variable shadowing. Local variable 'success,)' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 42,
        "column": 14,
        "length": 16
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in 'executeWithProof'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "shadowing-variables",
      "message": "Function 'verifyMerkleProof' contains variable shadowing. Local variable 'pure' shadows state variable Shadowing can cause confusion and lead to bugs where the wrong variable is accessed.",
      "severity": "medium",
      "location": {
        "line": 59,
        "column": 14,
        "length": 17
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Rename shadowing variables in 'verifyMerkleProof'. Use different names for local variables to avoid shadowing state variables. Consider prefixes like '_' for function parameters or descriptive names.",
        "replacements": []
      }
    },
    {
      "detector_id": "bridge-message-verification",
      "message": "Missing replay protection in 'processMessage'",
      "severity": "critical",
      "location": {
        "line": 19,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Add: require(!processedMessages[msgHash]); processedMessages[msgHash] = true;",
        "replacements": []
      }
    },
    {
      "detector_id": "bridge-message-verification",
      "message": "Missing replay protection in 'executeWithProof'",
      "severity": "critical",
      "location": {
        "line": 42,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Add: require(!processedMessages[msgHash]); processedMessages[msgHash] = true;",
        "replacements": []
      }
    },
    {
      "detector_id": "missing-chainid-validation",
      "message": "Missing chain-ID validation in 'processMessage'",
      "severity": "high",
      "location": {
        "line": 19,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Add chain-ID validation: require(message.destinationChainId == block.chainid); OR include chain-ID in message hash",
        "replacements": []
      }
    },
    {
      "detector_id": "missing-chainid-validation",
      "message": "Missing chain-ID validation in 'executeWithProof'",
      "severity": "high",
      "location": {
        "line": 42,
        "column": 0,
        "length": 20
      },
      "fix_suggestion": {
        "description": "Add chain-ID validation: require(message.destinationChainId == block.chainid); OR include chain-ID in message hash",
        "replacements": []
      }
    },
    {
      "detector_id": "floating-pragma",
      "message": "Floating pragma detected: pragma solidity ^0.8.0;. Using '^' allows compilation with multiple compiler versions, which may introduce unexpected behavior or security vulnerabilities. Different compiler versions may have different bugs, optimizations, or security fixes.",
      "severity": "low",
      "location": {
        "line": 2,
        "column": 0,
        "length": 23
      },
      "cwe": "CWE-710",
      "fix_suggestion": {
        "description": "Lock pragma to specific version: 'pragma solidity 0.8.0;'. This ensures consistent compilation across environments and prevents unexpected behavior from compiler version differences.",
        "replacements": []
      }
    },
    {
      "detector_id": "unused-state-variables",
      "message": "State variable 'success,)' is declared but never used. Unused state variables waste storage slots and increase deployment gas costs. Each unused storage slot costs gas during deployment.",
      "severity": "low",
      "location": {
        "line": 53,
        "column": 0,
        "length": 9
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused state variable 'success,)'. If this variable is intended for future use, consider adding a TODO comment. If it needs to maintain storage layout for upgradeable contracts, add a comment explaining this.",
        "replacements": []
      }
    },
    {
      "detector_id": "unused-state-variables",
      "message": "State variable 'for' is declared but never used. Unused state variables waste storage slots and increase deployment gas costs. Each unused storage slot costs gas during deployment.",
      "severity": "low",
      "location": {
        "line": 65,
        "column": 0,
        "length": 3
      },
      "cwe": "CWE-563",
      "fix_suggestion": {
        "description": "Remove unused state variable 'for'. If this variable is intended for future use, consider adding a TODO comment. If it needs to maintain storage layout for upgradeable contracts, add a comment explaining this.",
        "replacements": []
      }
    },
    {
      "detector_id": "l2-bridge-message-validation",
      "message": "Function 'processMessage' relays cross-layer messages without proper validation. Missing Merkle proof validation. Messages should verify against L2 state root This can lead to unauthorized message execution and bridge exploits.",
      "severity": "critical",
      "location": {
        "line": 19,
        "column": 14,
        "length": 14
      },
      "cwe": "CWE-345",
      "fix_suggestion": {
        "description": "Add proper validation to 'processMessage': (1) Verify Merkle proof against L1/L2 state root, (2) Check message finality (block confirmations), (3) Implement nonce/sequence tracking to prevent replay, (4) Validate message signatures, (5) Add cross-chain replay protection.",
        "replacements": []
      }
    },
    {
      "detector_id": "l2-bridge-message-validation",
      "message": "Function 'processMessage' relays cross-layer messages without proper validation. No finality check detected. Should verify sufficient block confirmations before execution This can lead to unauthorized message execution and bridge exploits.",
      "severity": "critical",
      "location": {
        "line": 19,
        "column": 14,
        "length": 14
      },
      "cwe": "CWE-345",
      "fix_suggestion": {
        "description": "Add proper validation to 'processMessage': (1) Verify Merkle proof against L1/L2 state root, (2) Check message finality (block confirmations), (3) Implement nonce/sequence tracking to prevent replay, (4) Validate message signatures, (5) Add cross-chain replay protection.",
        "replacements": []
      }
    },
    {
      "detector_id": "l2-bridge-message-validation",
      "message": "Function 'processMessage' relays cross-layer messages without proper validation. Missing nonce or sequence validation. Vulnerable to replay attacks This can lead to unauthorized message execution and bridge exploits.",
      "severity": "critical",
      "location": {
        "line": 19,
        "column": 14,
        "length": 14
      },
      "cwe": "CWE-345",
      "fix_suggestion": {
        "description": "Add proper validation to 'processMessage': (1) Verify Merkle proof against L1/L2 state root, (2) Check message finality (block confirmations), (3) Implement nonce/sequence tracking to prevent replay, (4) Validate message signatures, (5) Add cross-chain replay protection.",
        "replacements": []
      }
    },
    {
      "detector_id": "multisig-bypass",
      "message": "Missing nonce validation in signature verification (replay attack risk)",
      "severity": "critical",
      "location": {
        "line": 0,
        "column": 0,
        "length": 20
      },
      "cwe": "CWE-347",
      "fix_suggestion": {
        "description": "Add nonce tracking: mapping(bytes32 => bool) public executedTxs; Include nonce in signature hash: bytes32 hash = keccak256(abi.encodePacked(target, value, data, nonce));",
        "replacements": []
      }
    },
    {
      "detector_id": "multisig-bypass",
      "message": "Missing signature malleability protection (duplicate signature acceptance)",
      "severity": "high",
      "location": {
        "line": 0,
        "column": 0,
        "length": 20
      },
      "cwe": "CWE-347",
      "fix_suggestion": {
        "description": "Check s-value: require(uint256(s) <= 0x7FFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF5D576E7357A4501DDFE92F46681B20A0, \"Invalid s-value\"); This prevents signature malleability.",
        "replacements": []
      }
    },
    {
      "detector_id": "multisig-bypass",
      "message": "Signatures without expiration/deadline (indefinite validity risk)",
      "severity": "medium",
      "location": {
        "line": 0,
        "column": 0,
        "length": 20
      },
      "cwe": "CWE-347",
      "fix_suggestion": {
        "description": "Add expiration: Include deadline in signature data; require(block.timestamp <= deadline, \"Signature expired\"); Prevents execution of stale signatures.",
        "replacements": []
      }
    }
  ],
  "metadata": {
    "tool_name": "SolidityDefend",
    "tool_version": "0.8.0",
    "scan_type": "static_analysis",
    "language": "solidity",
    "rules_version": "0.8.0"
  },
  "statistics": {
    "total_findings": 31,
    "severity_counts": {
      "high": 7,
      "medium": 11,
      "critical": 6,
      "low": 7,
      "info": 0
    },
    "unique_detectors": 15
  }
}

Analysis complete:
  Files analyzed: 1
  Successful: 1
  Issues found: 31
  Time taken: 0.01s

Exiting with code 1 due to:
  - Found high or critical severity issues
